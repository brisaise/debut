const data = {
  event: {
    debutanteName: "Brisaise",
    eventDate: "2025-12-30",
    eventTime: "5:00 PM",
    venueName: "Octa Events Place",
    venueAddress: "222 Don Basilio Bautista Blvd, Malabon, 1480 Metro Manila",
    mapEmbedUrl: "https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d3859.4872354643003!2d120.9431284!3d14.6850165!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3397b54f44e20321%3A0x1e740390a7ec51c6!2sOCTA%20Events%20Place!5e0!3m2!1sen!2sph!4v1765374660191!5m2!1sen!2sph",
    theme: "An Elegant Evening",
    dressCode: "Formal / Semi-Formal Attire",
    dressCodeDetails: "Ladies are encouraged to wear elegant gowns or cocktail dresses. Gentlemen should wear suits or barong tagalog. You may wear any color of your choice, EXCEPT RED. Red is reserved exclusively for the debutante."
  },
  traditions: {
    roses: [
      { id: 1, name: "Mr.Ronaldo Tongco" }, { id: 2, name: "Fernando Tongco" },
      { id: 3, name: "John Jose De Guzman" }, { id: 4, name: "Christian Jose De Guzman" },
      { id: 5, name: "Jose Miguel De Guzman" }, { id: 6, name: "Rodde Maxel De Jesus" },
      { id: 7, name: "Tito Carlo Sambilay" }, { id: 8, name: "Tito Crizaldo Sambilay" },
      { id: 9, name: "Tito Celerino Sambilay" }, { id: 10, name: "Keith Aldridge Santos" },
      { id: 11, name: "Daniel Patrick Santos" }, { id: 12, name: "Albertson Mendiola" },
      { id: 13, name: "Markuz Ethan Gungon" }, { id: 14, name: "Rheyan Miguel Prim" },
      { id: 15, name: "Allan Christopher Malig"}, { id: 16, name: "Sir Christian Cedrick Publico" },
      { id: 17, name: "Czelraine Tongco" }, { id: 18, name: "Amiel Tongco" }
    ],
    candles: [
      { id: 1, name: "Tita Abigail Neones", role: "Moral Support" },
      { id: 2, name: "Tita Marianne Mendoza", role: "Strength" },
      { id: 3, name: "Dr. May Gungon", role: "Grace" },
      { id: 4, name: "Ma'am Tin Sarmiento", role: "Courage" },
      { id: 5, name: "Tita Emerita Balajo Santos", role: "Kindness" },
      { id: 6, name: "Tita Amparo Malig", role: "Perseverance" },
      { id: 7, name: "Tita Rocelyn De Jesus", role: "Joy" },
      { id: 8, name: "Tita Cecilia De Guzman", role: "Faith" },
      { id: 9, name: "Tita Lyn Haro", role: "Love" },
      { id: 10, name: "Tita Michelle De Guzman", role: "Honor" },
      { id: 11, name: "Nanay Edith Buenaventura", role: "Hope" },
      { id: 12, name: "Ate Ruby Aquino", role: "Patience" },
      { id: 13, name: "Ate Cesareen Sadile", role: "Knowledge" },
      { id: 14, name: "Tita Julie Ann Garcia", role: "Guidance" },
      { id: 15, name: "Miss Kristine Jamie Austria", role: "Generosity" },
      { id: 16, name: "Ma'am Ma. Kathleen Paraguya", role: "Spirituality" },
      { id: 17, name: "Ma'am Nadine Mendoza-Baksal", role: "Compassion" },
      { id: 18, name: "Jobelle Tongco", role: "Unconditional Love" }
    ],
    bills: [
      { id: 1, name: "Tito Rodelio De Jesus" }, { id: 2, name: "Tito Joel De Guzman" },
      { id: 3, name: "Tita Ronavie Sambilay" }, { id: 4, name: "Family Friend Tito John" },
      { id: 5, name: "Cousin Maria" }, { id: 6, name: "Cousin James" },
      { id: 7, name: "Neighbor Tita Susan" }, { id: 8, name: "Neighbor Tito Peter" },
      { id: 9, name: "Church Member Ate Linda" }, { id: 10, name: "Church Member Tito Frank" },
      { id: 11, name: "Parent's Friend Tita Rose" }, { id: 12, name: "Parent's Friend Tito Tom" },
      { id: 13, name: "Family Mentor Tita Emily" }, { id: 14, name: "Family Mentor Tito Steve" },
      { id: 15, name: "Community Leader Tita Jane" }, { id: 16, name: "Community Leader Tito Bob" },
      { id: 17, name: "Honored Guest Tita Mary" }, { id: 18, name: "Honored Guest Tito Paul" }
    ],
    treasures: [
      { id: 1, name: "Mother Rosario" }, { id: 2, name: "Sister Sofia" },
      { id: 3, name: "Grandmother Elena" }, { id: 4, name: "Aunt Patricia" },
      { id: 5, name: "Aunt Maria" }, { id: 6, name: "Cousin Angela" },
      { id: 7, name: "Godmother Carmen" }, { id: 8, name: "Best Friend Sarah" },
      { id: 9, name: "Best Friend Emma" }, { id: 10, name: "Childhood Friend Mia" },
      { id: 11, name: "Classmate Nicole" }, { id: 12, name: "Classmate Ashley" },
      { id: 13, name: "Church Friend Grace" }, { id: 14, name: "Teammate Julia" },
      { id: 15, name: "Neighbor Ate Joy" }, { id: 16, name: "Cousin Isabel" },
      { id: 17, name: "Mentor Teacher Ms. Reyes" }, { id: 18, name: "Special Friend Olivia" }
    ]
  },
  faq: [
    { id: 1, question: "What time should I arrive?", answer: "Please arrive 30 minutes before the program. Early arrival is appreciated to ensure you don't miss any of the special moments." },
    { id: 2, question: "Is there a parking area at the venue?", answer: "Yes, the Grand Ballroom has a spacious parking lot that can accommodate up to 200 vehicles. Valet parking is also available for your convenience at no additional charge." },
    { id: 3, question: "Is photography allowed during the event?", answer: "We have hired a professional photographer and videographer for the event. Personal photos are welcome during the reception, but we kindly ask that you refrain from using flash photography during the ceremonies." },
    { id: 4, question: "How long will the event last?", answer: "The event is expected to conclude around 9:00 PM. The program includes cocktails, dinner, traditional ceremonies, and dancing." }
  ],
  transport: [
    { id: 1, mode: "By Public Transport", icon: "üöå", description: "Take a jeepney to Hulong Duhat. From there, ride a tricycle to 'Octa Events Place' or '222 Cafe'. The venue is well-known to most drivers in the area." },
    { id: 2, mode: "By Taxi/Grab", icon: "üöï", description: "Simply input 'OCTA Events Place, 222, Don Basilio Bautista Blvd, Brgy. Dampalit, Malabon City' in your app. " }
  ],
  program: [
    { id: 1, title: "Guest Arrival & Cocktails", description: "Welcome drinks and registration" },
    { id: 2, title: "Grand Entrance", description: "The debutante's grand entrance with her court" },
    { id: 3, title: "Opening Prayer and Welcoming Remarks", description: ""},
    { id: 4, title: "18 Roses", description: "Traditional father-daughter dance and 18 roses dance" },
    { id: 5, title: "18 Candles", description: "Wishes and messages from 18 special women" },
    { id: 6, title: "Dinner Service", description: "Filipino-Western fusion dinner buffet" },
    { id: 7, title: "Open Photobooth", description: ""},
    { id: 8, title: "18 Blue Bills", description: ""},
    { id: 9, title: "18 Treasures", description: "Gift-giving ceremony with symbolic treasures" },
    { id: 10, title: "Message & Fast Talk", description: ""},
    { id: 11, title: "Thank You & Send-off", description: "Final thanks and farewell to guests" }
  ]
};

// Replace this with your real Formspree form ID, e.g. https://formspree.io/f/abcdwxyz
const FORMSPREE_ENDPOINT = "https://formspree.io/f/xrbnrbkv";

function renderTopBannerCountdown() {
  const timerEl = document.getElementById("top-banner-timer");
  if (!timerEl) return;
  const target = new Date("2025-12-30T00:00:00");
  function update() {
    const now = new Date();
    let diff = Math.max(target - now, 0);
    const days = Math.floor(diff / 86400000);
    diff -= days * 86400000;
    const hours = Math.floor(diff / 3600000);
    diff -= hours * 3600000;
    const minutes = Math.floor(diff / 60000);
    diff -= minutes * 60000;
    const seconds = Math.floor(diff / 1000);
    timerEl.textContent = `${days}d ${String(hours).padStart(2,"0")}h ${String(minutes).padStart(2,"0")}m ${String(seconds).padStart(2,"0")}s`;
  }
  update();
  setInterval(update, 1000);
}

function formatDate(iso) {
  return new Date(iso).toLocaleDateString("en-US", {
    weekday: "long", year: "numeric", month: "long", day: "numeric"
  });
}

function renderHero() {
  document.getElementById("hero-date").textContent = formatDate(data.event.eventDate);
}

function renderEventDetails() {
  document.getElementById("event-date").textContent = formatDate(data.event.eventDate);
  document.getElementById("event-time").textContent = data.event.eventTime;
  document.getElementById("venue-name").textContent = data.event.venueName;
  document.getElementById("venue-address").textContent = data.event.venueAddress;
  document.getElementById("map-embed").src = data.event.mapEmbedUrl;
}

function renderTheme() {
  document.getElementById("theme").textContent = data.event.theme;
  document.getElementById("dress-code").textContent = data.event.dressCode;
  document.getElementById("dress-code-details").textContent = data.event.dressCodeDetails;
}

function renderProgram() {
  const root = document.getElementById("program");
  root.innerHTML = "";
  data.program.forEach((item, idx) => {
    const div = document.createElement("div");
    div.className = "timeline-item";
    div.innerHTML = `
      <div class="timeline-bullet"></div>
      <div class="timeline-title">${item.title}</div>
      <p class="timeline-desc">${item.description}</p>
    `;
    root.appendChild(div);
  });
}

function renderTraditions() {
  const root = document.getElementById("traditions");
  root.innerHTML = "";
  
  // Order: Row 1: 18 Roses, 18 Candles, traditions.jpg
  //        Row 2: traditions_2.jpg, 18 Blue Bills, 18 Treasures
  const items = [
    { type: "card", title: "18 Roses", icon: "üåπ", list: data.traditions.roses, desc: "18 gentlemen for the rose dance" },
    { type: "card", title: "18 Candles", icon: "üïØÔ∏è", list: data.traditions.candles, desc: "18 ladies sharing wishes and wisdom" },
    { type: "image", src: "assets/traditions.jpg", alt: "Celebrating Traditions" },
    { type: "image", src: "assets/traditions_2.jpg", alt: "Celebrating Traditions" },
    { type: "card", title: "18 Blue Bills", icon: '<span style="color: var(--primary); font-weight: 800; font-size: 20px;">‚Ç±</span>', list: data.traditions.bills, desc: "18 special people presenting monetary gifts" },
    { type: "card", title: "18 Treasures", icon: "üéÅ", list: data.traditions.treasures, desc: "Meaningful gifts from 18 special people" }
  ];
  
  items.forEach((item) => {
    if (item.type === "image") {
      const img = document.createElement("img");
      img.src = item.src;
      img.alt = item.alt;
      img.className = "tradition-image";
      root.appendChild(img);
    } else {
      const card = document.createElement("div");
      card.className = "card tradition-card";
      card.innerHTML = `
        <div class="tradition-head">
          <div class="icon-wrap">${item.icon}</div>
          <div>
            <h3>${item.title}</h3>
            <p class="muted small">${item.desc}</p>
          </div>
        </div>
        <ol class="tradition-list">
          ${item.list.map((p, i) => `
            <li class="tradition-item">
              <span class="tradition-num">${i + 1}.</span>
              <span>${p.name}</span>
              ${p.role ? `<span class="tradition-role">‚Äî ${p.role}</span>` : ""}
            </li>
          `).join("")}
        </ol>
      `;
      root.appendChild(card);
    }
  });
}

function renderTransport() {
  const root = document.getElementById("transport");
  root.innerHTML = "";
  data.transport.forEach(tip => {
    const card = document.createElement("div");
    card.className = "card transport-card";
    card.innerHTML = `
      <div class="transport-head">
        <div class="transport-icon">${tip.icon}</div>
        <h3>${tip.mode}</h3>
      </div>
      <p class="muted">${tip.description}</p>
    `;
    root.appendChild(card);
  });
}

function renderFAQ() {
  const root = document.getElementById("faq");
  root.innerHTML = "";
  data.faq.forEach(item => {
    const acc = document.createElement("div");
    acc.className = "accordion-item";
    acc.innerHTML = `
      <div class="accordion-header">
        <span>${item.question}</span>
        <span class="accordion-toggle">+</span>
      </div>
      <div class="accordion-body">${item.answer}</div>
    `;
    acc.querySelector(".accordion-header").addEventListener("click", () => {
      acc.classList.toggle("open");
      acc.querySelector(".accordion-toggle").textContent = acc.classList.contains("open") ? "‚Äì" : "+";
    });
    root.appendChild(acc);
  });
}

function renderFooter() {
  document.getElementById("footer-name").textContent = data.event.debutanteName;
}

function setupRSVP() {
  const form = document.getElementById("rsvp-form");
  if (!form) return;

  const details = document.getElementById("rsvp-details");
  const status = document.getElementById("rsvp-status");
  const attendanceInputs = form.querySelectorAll("input[name='attending']");
  const detailFields = details.querySelectorAll("[data-required-yes]");

  function toggleDetails(isAttending) {
    const showDetails = isAttending === "yes";
    details.classList.toggle("hidden", !showDetails);
    detailFields.forEach(input => { input.required = showDetails; });
  }

  attendanceInputs.forEach(input => {
    input.addEventListener("change", (e) => {
      toggleDetails(e.target.value);
      status.textContent = "";
      status.className = "status";
    });
  });

  form.addEventListener("submit", (e) => {
    e.preventDefault();
    const attending = form.attending.value;

    status.className = "status";
    status.textContent = "";

    const name = form.name.value.trim();
    const contact = form.contact.value.trim();

    if (!name || !contact) {
      status.textContent = "Please share your name and contact info so we can note your RSVP.";
      status.classList.add("error");
      return;
    }

    if (attending === "yes") {
      const guests = form.guests.value || "1";
      const dietary = form.dietary.value.trim();

      if (!guests || Number(guests) < 1) {
        status.textContent = "Please tell us how many are coming so we can reserve seats.";
        status.classList.add("error");
        return;
      }

      status.textContent = `Thank you, ${name}! We've reserved ${guests} seat(s) for you. We'll follow up via ${contact}.${dietary ? ` Dietary notes: ${dietary}.` : ""}`;
      status.classList.add("success");
    } else if (attending === "no") {
      toggleDetails("no");
      status.textContent = `Thanks, ${name}. We'll miss you at the celebration.`;
      status.classList.add("success");
    } else if (attending === "unsure") {
      toggleDetails("no");
      status.textContent = `Thanks, ${name}. Marking you as tentative‚Äîplease update us when you can.`;
      status.classList.add("success");
    } else {
      status.textContent = "Please select if you are attending.";
      status.classList.add("error");
      return;
    }

    // Prevent sending if placeholder endpoint is still present
    if (FORMSPREE_ENDPOINT.includes("yourFormId")) {
      status.textContent = "Formspree endpoint is not set yet. Replace it with your form ID.";
      status.classList.add("error");
      return;
    }

    const formData = new FormData(form);
    formData.set("attending", attending);

    status.textContent = "Sending your RSVP‚Ä¶";
    status.className = "status";

    fetch(FORMSPREE_ENDPOINT, {
      method: "POST",
      body: formData,
      headers: { Accept: "application/json" }
    }).then(async (resp) => {
      if (resp.ok) {
        status.textContent = "RSVP received! Thank you.";
        status.classList.add("success");
        form.reset();
        toggleDetails("no");
      } else {
        const msg = (await resp.json().catch(() => ({}))).errors?.[0]?.message;
        status.textContent = msg || "There was a problem sending your RSVP. Please try again.";
        status.classList.add("error");
      }
    }).catch(() => {
      status.textContent = "Network error. Please try again.";
      status.classList.add("error");
    });
  });
}

function renderCountdown() {
  const target = new Date(data.event.eventDate + "T00:00:00");
  const el = document.getElementById("countdown");
  function update() {
    const now = new Date();
    let diff = Math.max(target - now, 0);
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
    diff -= days * 86400000;
    const hours = Math.floor(diff / (1000 * 60 * 60));
    diff -= hours * 3600000;
    const minutes = Math.floor(diff / (1000 * 60));
    diff -= minutes * 60000;
    const seconds = Math.floor(diff / 1000);

    el.innerHTML = ["Days", "Hours", "Minutes", "Seconds"].map((label, i) => {
      const val = [days, hours, minutes, seconds][i];
      return `<div class="countdown-box">
        <div class="countdown-value">${String(val).padStart(2, "0")}</div>
        <div class="countdown-label">${label}</div>
      </div>`;
    }).join("");
  }
  update();
  setInterval(update, 1000);
}

function init() {
  renderHero();
  renderEventDetails();
  renderTheme();
  renderProgram();
  renderTraditions();
  renderTransport();
  renderFAQ();
  renderFooter();
  renderCountdown();
  renderTopBannerCountdown(); // add this
  setupRSVP();
}

document.addEventListener("DOMContentLoaded", init);